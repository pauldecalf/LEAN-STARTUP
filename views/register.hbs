<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accueil - Inscription</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Consultez les mentions légales de Smoozy pour tout savoir sur nos conditions d'utilisation et informations légales.">
    <meta name="author" content="Smoozy">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Mentions légales - Smoozy">
    <meta property="og:description" content="Consultez les mentions légales de Smoozy pour tout savoir sur nos conditions d'utilisation et informations légales.">
    <meta property="og:image" content="/img/Hero-Image.svg">
    <meta property="og:url" content="https://smoozy-app.com/">
    <meta property="og:type" content="website">

    <!-- Canonical Link -->
    <link rel="canonical" href="https://smoozy-app.com/">
    <link rel="icon" type="image/png" href="/img/favicon.png">
    <link href="/styles.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,200..800&display=swap" rel="stylesheet">

    <!-- Google Tag Manager -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DSKHG4RCJG"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-DSKHG4RCJG');
    </script>

    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<body>
<main>

    <section class="register-section">
      <!-- Bouton pour revenir en arrière -->
      <a href="/loading" class="cta-back-to-loading">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M11.29 17.71C11.3837 17.617 11.4581 17.5064 11.5089 17.3846C11.5597 17.2627 11.5858 17.132 11.5858 17C11.5858 16.868 11.5597 16.7373 11.5089 16.6154C11.4581 16.4936 11.3837 16.383 11.29 16.29L8 13L18 13C18.2652 13 18.5196 12.8946 18.7071 12.7071C18.8946 12.5196 19 12.2652 19 12C19 11.7348 18.8946 11.4804 18.7071 11.2929C18.5196 11.1054 18.2652 11 18 11L8 11L11.29 7.71C11.3837 7.61704 11.4581 7.50644 11.5089 7.38458C11.5597 7.26272 11.5858 7.13201 11.5858 7C11.5858 6.86799 11.5597 6.73728 11.5089 6.61542C11.4581 6.49356 11.3837 6.38296 11.29 6.29C11.1026 6.10375 10.8492 5.99921 10.585 5.99921C10.3208 5.99921 10.0674 6.10375 9.88 6.29L5.59 10.59C5.21441 10.9634 5.00223 11.4704 5 12C5.00486 12.5261 5.21684 13.0291 5.59 13.4L9.88 17.7C10.066 17.8876 10.3187 17.9939 10.5829 17.9958C10.8471 17.9977 11.1013 17.8949 11.29 17.71Z" fill="white"/>
        </svg>
      </a>

      <h1>Créez un compte !</h1>

      <p id="message"></p>
      <form class="register-form-email" onsubmit="handleRegister(event)">
        <input id="prenom-input" class="register-input" placeholder="Prénom*" type="text" name="prenom" autocomplete="given-name">
        <input id="email-input" class="register-input" type="text" name="email" placeholder="Adresse email*" autocomplete="username">
        <input id="password-input" class="register-input" type="password" name="password" placeholder="Mot de passe*" autocomplete="current-password">
        <p id="password-instructions" class="register-instructions-password">8 caractères, 1 majuscule, 1 chiffre</p>
        <button id="register-button" type="submit" class="cta-register-lock" disabled>Je m'inscris</button>
        <p class="register-p-mentions-legales">
          En continuant, vous acceptez les <a href="/mentionslegales">conditions d'utilisation</a> et la <a href="/politiqueconfidentialite">politique de confidentialité</a> de Smoozy.
        </p>
      </form>
      <p class="register-separator">ou</p>

      <div id="g_id_onload"
           data-client_id="152404122949-28cgi4vta9vreupt8m4armb4h0l886ck.apps.googleusercontent.com"
           data-context="signup"
           data-ux_mode="popup"
           data-callback="handleCredentialResponse"
           data-auto_prompt="false">
      </div>
      <div class="g_id_signin"
           data-type="standard"
           data-shape="rectangular"
           data-theme="outline"
           data-text="signin_with"
           data-size="large">
      </div>

      <p class="register-p-to-login">Déjà inscrit ? <a href="/login">Connectez-vous !</a></p>

    </section>

    <!-- Banniere des cookies -->
    <div id="cookie-banner" class="cookie-banner">
        <p>Nous utilisons des cookies pour améliorer votre expérience sur notre site. En poursuivant votre navigation, vous acceptez notre <a href="/politiqueconfidentialite">politique de confidentialité</a>.</p>
        <button onclick="acceptCookies()">Accepter</button>
    </div>

</main>

<script>
    function handleRegister(event) {
        event.preventDefault();
        const prenom = document.getElementById('prenom-input').value;
        const email = document.getElementById('email-input').value;
        const password = document.getElementById('password-input').value;

        // Validation simplifiée des champs de formulaire
        if (!prenom || !email || !password) {
            document.getElementById('message').innerText = 'Tous les champs sont obligatoires.';
            return;
        }

        fetch('/register', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ prenom, email, password })
        })
        .then(response => response.json())
        .then(data => {
            if (data.message === 'Inscription réussie') {
                sessionStorage.setItem('prenom', data.user.prenom);  // Stocker le prénom dans sessionStorage
                sessionStorage.setItem('nom', data.user.nom);        // Stocker le nom dans sessionStorage
                sessionStorage.setItem('email', data.user.email);    // Stocker l'email dans sessionStorage
                window.location.href = '/family-setup';
            } else {
                document.getElementById('message').innerText = data.message;
            }
        })
        .catch(error => {
            console.error('Error:', error);
            document.getElementById('message').innerText = 'Une erreur est survenue. Veuillez réessayer plus tard.';
        });
    }

    function handleCredentialResponse(response) {
        fetch('/register/google', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ idToken: response.credential })
        })
        .then(response => response.json())
        .then(data => {
            if (data.message === 'Connexion réussie' || data.message === 'Inscription réussie avec Google') {
                sessionStorage.setItem('prenom', data.user.prenom);  // Stocker le prénom dans sessionStorage
                sessionStorage.setItem('nom', data.user.nom);        // Stocker le nom dans sessionStorage
                sessionStorage.setItem('email', data.user.email);    // Stocker l'email dans sessionStorage
                window.location.href = '/family-setup';
            } else {
                document.getElementById('message').innerText = data.message;
            }
        })
        .catch(error => {
            console.error('Error:', error);
            document.getElementById('message').innerText = 'Une erreur est survenue. Veuillez réessayer plus tard.';
        });
    }

    function checkInputs() {
        const prenom = document.getElementById('prenom-input');
        const email = document.getElementById('email-input');
        const password = document.getElementById('password-input');
        const registerButton = document.getElementById('register-button');
        const passwordInstructions = document.getElementById('password-instructions');

        const passwordRegex = /^(?=.*[A-Z])(?=.*\d)[A-Za-z\d]{8,}$/;

        if (prenom.value && email.value && password.value.match(passwordRegex)) {
            registerButton.disabled = false;
            registerButton.style.backgroundColor = '#7059D7';
            registerButton.style.color = '#FFF';
            prenom.style.borderColor = '#52A5FF';
            email.style.borderColor = '#52A5FF';
            password.style.borderColor = '#52A5FF';
            passwordInstructions.style.color = '#52A5FF';
        } else {
            registerButton.disabled = true;
            registerButton.style.backgroundColor = '';
            registerButton.style.color = '';
            prenom.style.borderColor = '';
            email.style.borderColor = '';
            password.style.borderColor = '';
            passwordInstructions.style.color = password.value ? 'red' : '';
        }
    }

    document.getElementById('prenom-input').addEventListener('input', checkInputs);
    document.getElementById('email-input').addEventListener('input', checkInputs);
    document.getElementById('password-input').addEventListener('input', checkInputs);
</script>

<script>
  if (!navigator.cookieEnabled) {
    document.getElementById('message').innerText = 'Les cookies sont désactivés dans votre navigateur. Veuillez les activer pour utiliser l\'authentification Google.';
  }

  document.addEventListener('DOMContentLoaded', (event) => {
    // Vérifiez si un script Google n'est pas chargé
    const googleSignInButton = document.querySelector('.g_id_signin');
    if (!googleSignInButton) {
      const messageDiv = document.createElement('div');
      messageDiv.style.color = 'red';
      messageDiv.innerText = 'Il semble qu\'un bloqueur de publicités ou un autre logiciel de blocage empêche certaines fonctionnalités de fonctionner correctement. Veuillez désactiver ces extensions pour ce site.';
      document.body.prepend(messageDiv);
    }
  });
</script>

</body>
</html>
